<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· ÎœÎ±Î¸Î·Ï„ÏÎ½ - Admin Panel</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;400&display=swap" rel="stylesheet">
  <style>
    .admin-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .admin-header {
      background: linear-gradient(135deg, #2C5F4F, #4A7C59);
      color: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 30px;
      text-align: center;
    }
    
    .search-section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .search-bar {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: flex-start;
      visibility: visible !important;
    }
    
    .search-bar * {
      visibility: visible !important;
      opacity: 1 !important;
    }

    /* Specific styling for search bar buttons */
    .search-bar .btn {
      flex-shrink: 0;
      background-color: #E39C50 !important;
      color: white !important;
      border: 2px solid #E39C50 !important;
      font-weight: bold;
      min-height: 44px;
      display: inline-flex !important;
      align-items: center;
      justify-content: center;
    }

    .search-bar .btn-success {
      background-color: #28a745 !important;
      border-color: #28a745 !important;
    }

    .search-bar .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    /* Action buttons bar styling */
    .action-buttons-bar {
      display: flex !important;
      gap: 15px;
      margin-top: 15px;
      flex-wrap: wrap;
    }

    .action-buttons-bar .btn {
      display: inline-block !important;
      visibility: visible !important;
      opacity: 1 !important;
      position: relative;
      z-index: 10;
      background: #E39C50 !important;
      color: white !important;
      border: none !important;
      padding: 12px 20px !important;
      border-radius: 5px !important;
      font-weight: bold !important;
      cursor: pointer !important;
      transition: all 0.3s ease !important;
    }

    .action-buttons-bar .btn-success {
      background: #28a745 !important;
    }

    .action-buttons-bar .btn-info {
      background: #17a2b8;
      color: white;
    }
    
    .action-buttons-bar .btn-info:hover {
      background: #138496;
    }

    .action-buttons-bar .btn:hover {
      transform: translateY(-2px) !important;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3) !important;
    }
    
    .search-input {
      flex: 1;
      min-width: 200px;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 5px;
      font-size: 14px;
    }
    
    .btn {
      padding: 12px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
      text-align: center;
      font-size: 14px;
      white-space: nowrap;
      min-width: auto;
      visibility: visible !important;
      opacity: 1 !important;
      z-index: 1;
    }
    
    .btn-primary {
      background: #E39C50;
      color: white;
    }
    
    .btn-primary:hover {
      background: #d18a3d;
    }
    
    .btn-success {
      background: #28a745;
      color: white;
    }
    
    .btn-success:hover {
      background: #218838;
    }
    
    .btn-danger {
      background: #dc3545;
      color: white;
    }
    
    .btn-danger:hover {
      background: #c82333;
    }
    
    .btn-small {
      padding: 8px 12px;
      font-size: 12px;
      margin: 2px;
    }
    
    .students-table {
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    
    .students-table table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .students-table th,
    .students-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }
    
    .students-table th {
      background: #2C5F4F;
      color: white;
      font-weight: bold;
    }
    
    .students-table tr:hover {
      background: #f8f9fa;
    }
    
    .action-buttons {
      display: flex;
      gap: 5px;
      flex-wrap: wrap;
    }
    
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
    }
    
    .modal-content {
      background-color: white;
      margin: 5% auto;
      padding: 30px;
      border-radius: 10px;
      width: 90%;
      max-width: 600px;
      max-height: 80%;
      overflow-y: auto;
    }
    
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    
    .close:hover {
      color: black;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #333;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 5px;
      font-size: 14px;
      box-sizing: border-box;
    }
    
    .form-row {
      display: flex;
      gap: 15px;
    }
    
    .form-row .form-group {
      flex: 1;
    }
    
    .alert {
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 5px;
      display: none;
    }
    
    .alert-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .alert-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .student-details {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 15px;
    }
    
    @media (max-width: 768px) {
      .search-bar {
        flex-direction: column;
      }
      
      .form-row {
        flex-direction: column;
      }
      
      .students-table {
        overflow-x: auto;
      }
      
      .action-buttons {
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <div class="logo"><img src="logo.png" alt="logo"></div>
      <nav>
        <a href="admin.html">Admin Dashboard</a>
        <a href="admin-kartela.html">Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· ÎœÎ±Î¸Î·Ï„ÏÎ½</a>
        <a href="admin-pallia-themata.html">Î Î±Î»Î¹Î¬ Î˜Î­Î¼Î±Ï„Î±</a>
        <a href="admin-vaseis-scholon.html">Î’Î¬ÏƒÎµÎ¹Ï‚ Î£Ï‡Î¿Î»ÏÎ½</a>
        <a href="admin-mixanografiko.html">ÎœÎ·Ï‡Î±Î½Î¿Î³ÏÎ±Ï†Î¹ÎºÏŒ</a>
      </nav>
      <div class="icons">
        <a href="#"><img src="\elements\Group 17.svg" alt="fb" class="facebook-icon"></a>
        <a href="#"><img src="\elements\mdi_instagram.svg" alt="insta" class="instagram-icon"></a>
        <a href="#"><img src="\elements\phone.svg" alt="phone"></a>
        <a href="#"><img src="\elements\mail.svg" alt="mail"></a>
      </div>
      <a href="index.html" class="login-btn" style="text-decoration: none;">ÎˆÎ¾Î¿Î´Î¿Ï‚</a>
    </div>
  </header>
  
  <main>
    <div class="admin-container">
      <div class="admin-header">
        <h1>Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· ÎœÎ±Î¸Î·Ï„ÏÎ½</h1>
        <p>Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·, Ï€ÏÎ¿ÏƒÎ¸Î®ÎºÎ·, ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± ÎºÎ±Î¹ Î´Î¹Î±Î³ÏÎ±Ï†Î® Î¼Î±Î¸Î·Ï„ÏÎ½</p>
      </div>

      <!-- Alerts -->
      <div id="alertSuccess" class="alert alert-success"></div>
      <div id="alertError" class="alert alert-error"></div>

      <!-- Search Section -->
      <div class="search-section">
        <h3>Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· ÎœÎ±Î¸Î·Ï„ÏÎ½</h3>
        <div class="search-bar">
          <input type="text" id="searchInput" class="search-input" placeholder="Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î¼Îµ ÏŒÎ½Î¿Î¼Î±, ÎµÏ€ÏÎ½Ï…Î¼Î¿, Ï„Î·Î»Î­Ï†Ï‰Î½Î¿ Î® email...">
          <select id="classFilter" class="search-input" style="flex: 0 0 200px;">
            <option value="">ÎŒÎ»ÎµÏ‚ Î¿Î¹ Ï„Î¬Î¾ÎµÎ¹Ï‚</option>
            <option value="Î‘' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…">Î‘' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…</option>
            <option value="Î’' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…">Î’' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…</option>
            <option value="Î“' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…">Î“' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…</option>
            <option value="Î‘' Î›Ï…ÎºÎµÎ¯Î¿Ï…">Î‘' Î›Ï…ÎºÎµÎ¯Î¿Ï…</option>
            <option value="Î’' Î›Ï…ÎºÎµÎ¯Î¿Ï…">Î’' Î›Ï…ÎºÎµÎ¯Î¿Ï…</option>
            <option value="Î“' Î›Ï…ÎºÎµÎ¯Î¿Ï…">Î“' Î›Ï…ÎºÎµÎ¯Î¿Ï…</option>
          </select>
        </div>
        
        <!-- Action Buttons -->
        <div class="action-buttons-bar" style="display: flex; gap: 15px; margin-top: 15px; flex-wrap: wrap;">
          <button type="button" class="btn btn-primary" onclick="searchStudents()" style="display: inline-block !important;">
            ğŸ” Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·
          </button>
          <button type="button" class="btn btn-success" onclick="openAddModal()" style="display: inline-block !important;">
            â• ÎÎ­Î¿Ï‚ ÎœÎ±Î¸Î·Ï„Î®Ï‚
          </button>
          <button type="button" class="btn btn-primary" onclick="openSubjectsModal()" style="display: inline-block !important;">
            ğŸ“š Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Î¤Î¼Î·Î¼Î¬Ï„Ï‰Î½
          </button>
        </div>
      </div>

      <!-- Students Table -->
      <div class="students-table">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>ÎŒÎ½Î¿Î¼Î±</th>
              <th>Î•Ï€ÏÎ½Ï…Î¼Î¿</th>
              <th>Î¤Î¬Î¾Î·</th>
              <th>Î¤Î¼Î®Î¼Î±Ï„Î±/ÎœÎ±Î¸Î®Î¼Î±Ï„Î±</th>
              <th>Î¤Î·Î»Î­Ï†Ï‰Î½Î¿</th>
              <th>Email</th>
              <th>Î—Î¼. Î•Î³Î³ÏÎ±Ï†Î®Ï‚</th>
              <th>Î•Î½Î­ÏÎ³ÎµÎ¹ÎµÏ‚</th>
            </tr>
          </thead>
          <tbody id="studentsTableBody">
            <!-- Students will be loaded here -->
          </tbody>
        </table>
      </div>

      <!-- Subjects/Classes Management Section -->
      <div class="search-section" style="margin-top: 40px;">
        <h3>Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Î¤Î¼Î·Î¼Î¬Ï„Ï‰Î½/ÎœÎ±Î¸Î·Î¼Î¬Ï„Ï‰Î½</h3>
        <div class="search-bar">
          <input type="text" id="subjectSearchInput" class="search-input" placeholder="Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î¼Îµ ÏŒÎ½Î¿Î¼Î± Î¼Î±Î¸Î®Î¼Î±Ï„Î¿Ï‚, ÎºÏ‰Î´Î¹ÎºÏŒ Î® ÎºÎ±Î¸Î·Î³Î·Ï„Î®...">
          <select id="subjectClassFilter" class="search-input" style="flex: 0 0 200px;">
            <option value="">ÎŒÎ»ÎµÏ‚ Î¿Î¹ Ï„Î¬Î¾ÎµÎ¹Ï‚</option>
            <option value="Î‘' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…">Î‘' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…</option>
            <option value="Î’' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…">Î’' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…</option>
            <option value="Î“' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…">Î“' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…</option>
            <option value="Î‘' Î›Ï…ÎºÎµÎ¯Î¿Ï…">Î‘' Î›Ï…ÎºÎµÎ¯Î¿Ï…</option>
            <option value="Î’' Î›Ï…ÎºÎµÎ¯Î¿Ï…">Î’' Î›Ï…ÎºÎµÎ¯Î¿Ï…</option>
            <option value="Î“' Î›Ï…ÎºÎµÎ¯Î¿Ï…">Î“' Î›Ï…ÎºÎµÎ¯Î¿Ï…</option>
          </select>
        </div>
        
        <!-- Action Buttons -->
        <div class="action-buttons-bar" style="display: flex; gap: 15px; margin-top: 15px; flex-wrap: wrap;">
          <button type="button" class="btn btn-primary" onclick="searchSubjects()" style="display: inline-block !important;">
            ğŸ” Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î¤Î¼Î·Î¼Î¬Ï„Ï‰Î½
          </button>
          <button type="button" class="btn btn-success" onclick="openAddSubjectModal()" style="display: inline-block !important;">
            â• ÎÎ­Î¿ Î¤Î¼Î®Î¼Î±
          </button>
        </div>
      </div>

      <!-- Subjects Table -->
      <div class="students-table" style="margin-top: 20px;">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>ÎœÎ¬Î¸Î·Î¼Î±</th>
              <th>ÎšÏ‰Î´Î¹ÎºÏŒÏ‚</th>
              <th>Î¤Î¬Î¾Î·</th>
              <th>ÎšÎ±Î¸Î·Î³Î·Ï„Î®Ï‚</th>
              <th>Î•Î¹Î´Î¹ÎºÏŒÏ„Î·Ï„Î±</th>
              <th>Î•Î³Î³ÎµÎ³ÏÎ±Î¼Î¼Î­Î½Î¿Î¹</th>
              <th>Î•Î½Î­ÏÎ³ÎµÎ¹ÎµÏ‚</th>
            </tr>
          </thead>
          <tbody id="subjectsTableBody">
            <!-- Subjects will be loaded here -->
          </tbody>
        </table>
      </div>

      <!-- Teachers Management Section -->
      <div class="search-section" style="margin-top: 40px;">
        <h3>Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· ÎšÎ±Î¸Î·Î³Î·Ï„ÏÎ½</h3>
        <div class="search-bar">
          <input type="text" id="teacherSearchInput" class="search-input" placeholder="Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î¼Îµ ÏŒÎ½Î¿Î¼Î±, ÎµÎ¹Î´Î¹ÎºÏŒÏ„Î·Ï„Î± Î® email ÎºÎ±Î¸Î·Î³Î·Ï„Î®...">
          <select id="teacherSubjectFilter" class="search-input" style="flex: 0 0 200px;">
            <option value="">ÎŒÎ»ÎµÏ‚ Î¿Î¹ ÎµÎ¹Î´Î¹ÎºÏŒÏ„Î·Ï„ÎµÏ‚</option>
            <option value="ÎœÎ±Î¸Î·Î¼Î±Ï„Î¹ÎºÎ¬">ÎœÎ±Î¸Î·Î¼Î±Ï„Î¹ÎºÎ¬</option>
            <option value="Î¦Ï…ÏƒÎ¹ÎºÎ®">Î¦Ï…ÏƒÎ¹ÎºÎ®</option>
            <option value="Î§Î·Î¼ÎµÎ¯Î±">Î§Î·Î¼ÎµÎ¯Î±</option>
            <option value="Î‘ÏÏ‡Î±Î¯Î±">Î‘ÏÏ‡Î±Î¯Î±</option>
            <option value="ÎÎ­Î± Î•Î»Î»Î·Î½Î¹ÎºÎ¬">ÎÎ­Î± Î•Î»Î»Î·Î½Î¹ÎºÎ¬</option>
            <option value="Î™ÏƒÏ„Î¿ÏÎ¯Î±">Î™ÏƒÏ„Î¿ÏÎ¯Î±</option>
            <option value="Î“ÎµÏ‰Î³ÏÎ±Ï†Î¯Î±">Î“ÎµÏ‰Î³ÏÎ±Ï†Î¯Î±</option>
          </select>
        </div>
        
        <!-- Action Buttons -->
        <div class="action-buttons-bar" style="display: flex; gap: 15px; margin-top: 15px; flex-wrap: wrap;">
          <button type="button" class="btn btn-primary" onclick="searchTeachers()" style="display: inline-block !important;">
            ğŸ” Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· ÎšÎ±Î¸Î·Î³Î·Ï„ÏÎ½
          </button>
          <button type="button" class="btn btn-success" onclick="openAddTeacherModal()" style="display: inline-block !important;">
            â• ÎÎ­Î¿Ï‚ ÎšÎ±Î¸Î·Î³Î·Ï„Î®Ï‚
          </button>
        </div>
      </div>

      <!-- Teachers Table -->
      <div class="students-table" style="margin-top: 20px;">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>ÎŒÎ½Î¿Î¼Î±</th>
              <th>Î•Î¹Î´Î¹ÎºÏŒÏ„Î·Ï„Î±</th>
              <th>Î¤Î·Î»Î­Ï†Ï‰Î½Î¿</th>
              <th>Email</th>
              <th>Î¤Î¼Î®Î¼Î±Ï„Î± Ï€Î¿Ï… Î´Î¹Î´Î¬ÏƒÎºÎµÎ¹</th>
              <th>Î•Î½Î­ÏÎ³ÎµÎ¹ÎµÏ‚</th>
            </tr>
          </thead>
          <tbody id="teachersTableBody">
            <!-- Teachers will be loaded here -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Add/Edit Student Modal -->
    <div id="studentModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2 id="modalTitle">Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎÎ­Î¿Ï… ÎœÎ±Î¸Î·Ï„Î®</h2>
        
        <form id="studentForm">
          <input type="hidden" id="studentId">
          
          <div class="form-row">
            <div class="form-group">
              <label for="firstName">ÎŒÎ½Î¿Î¼Î± *</label>
              <input type="text" id="firstName" required>
            </div>
            <div class="form-group">
              <label for="lastName">Î•Ï€ÏÎ½Ï…Î¼Î¿ *</label>
              <input type="text" id="lastName" required>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="studentClass">Î¤Î¬Î¾Î· *</label>
              <select id="studentClass" required>
                <option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï„Î¬Î¾Î·</option>
                <option value="Î‘' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…">Î‘' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…</option>
                <option value="Î’' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…">Î’' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…</option>
                <option value="Î“' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…">Î“' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…</option>
                <option value="Î‘' Î›Ï…ÎºÎµÎ¯Î¿Ï…">Î‘' Î›Ï…ÎºÎµÎ¯Î¿Ï…</option>
                <option value="Î’' Î›Ï…ÎºÎµÎ¯Î¿Ï…">Î’' Î›Ï…ÎºÎµÎ¯Î¿Ï…</option>
                <option value="Î“' Î›Ï…ÎºÎµÎ¯Î¿Ï…">Î“' Î›Ï…ÎºÎµÎ¯Î¿Ï…</option>
              </select>
            </div>
            <div class="form-group">
              <label for="birthDate">Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± Î“Î­Î½Î½Î·ÏƒÎ·Ï‚</label>
              <input type="date" id="birthDate">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="phone">Î¤Î·Î»Î­Ï†Ï‰Î½Î¿ *</label>
              <input type="tel" id="phone" required>
            </div>
            <div class="form-group">
              <label for="email">Email</label>
              <input type="email" id="email">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="username">Username *</label>
              <input type="text" id="username" required placeholder="Ï€.Ï‡. mariap, giannisd">
              <small style="color: #666; font-size: 12px;">ÎœÎ¿Î½Î±Î´Î¹ÎºÏŒ ÏŒÎ½Î¿Î¼Î± Ï‡ÏÎ®ÏƒÏ„Î· Î³Î¹Î± ÏƒÏÎ½Î´ÎµÏƒÎ·</small>
            </div>
            <div class="form-group">
              <label for="password">ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ *</label>
              <input type="text" id="password" required placeholder="ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚">
              <small style="color: #666; font-size: 12px;">ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ Ï€Î¿Ï… Î¸Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Î¿ Î¼Î±Î¸Î·Ï„Î®Ï‚</small>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="parentName">ÎŒÎ½Î¿Î¼Î± Î“Î¿Î½Î­Î±</label>
              <input type="text" id="parentName">
            </div>
            <div class="form-group">
              <label for="parentPhone">Î¤Î·Î»Î­Ï†Ï‰Î½Î¿ Î“Î¿Î½Î­Î±</label>
              <input type="tel" id="parentPhone">
            </div>
          </div>

          <div class="form-group">
            <label for="address">Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·</label>
            <textarea id="address" rows="3"></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="enrollmentDate">Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± Î•Î³Î³ÏÎ±Ï†Î®Ï‚</label>
              <input type="date" id="enrollmentDate">
            </div>
            <div class="form-group">
              <label for="status">ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·</label>
              <select id="status">
                <option value="active">Î•Î½ÎµÏÎ³ÏŒÏ‚</option>
                <option value="inactive">Î‘Î½ÎµÎ½ÎµÏÎ³ÏŒÏ‚</option>
                <option value="graduated">Î‘Ï€ÏŒÏ†Î¿Î¹Ï„Î¿Ï‚</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="notes">Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚</label>
            <textarea id="notes" rows="4"></textarea>
          </div>

          <div style="text-align: center; margin-top: 30px;">
            <button type="button" class="btn btn-primary" onclick="closeModal()">Î‘ÎºÏÏÏ‰ÏƒÎ·</button>
            <button type="submit" class="btn btn-success">Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·</button>
          </div>
        </form>
      </div>
    </div>

    <!-- View Student Modal -->
    <div id="viewStudentModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeViewModal()">&times;</span>
        <h2>Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± ÎœÎ±Î¸Î·Ï„Î®</h2>
        <div id="studentDetailsContent">
          <!-- Student details will be loaded here -->
        </div>
        <div style="text-align: center; margin-top: 20px;">
          <button class="btn btn-primary" onclick="closeViewModal()">ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿</button>
        </div>
      </div>
    </div>

    <!-- Subjects/Classes Management Modal -->
    <div id="subjectsModal" class="modal">
      <div class="modal-content" style="max-width: 800px;">
        <span class="close" onclick="closeSubjectsModal()">&times;</span>
        <h2>Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Î¤Î¼Î·Î¼Î¬Ï„Ï‰Î½ ÎºÎ±Î¹ ÎœÎ±Î¸Î·Î¼Î¬Ï„Ï‰Î½</h2>
        
        <div style="margin-bottom: 30px;">
          <h3>Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎÎ­Î¿Ï… Î¤Î¼Î®Î¼Î±Ï„Î¿Ï‚</h3>
          <form id="subjectForm" style="display: flex; gap: 10px; align-items: end; flex-wrap: wrap;">
            <div class="form-group" style="margin-bottom: 0; flex: 1; min-width: 150px;">
              <label for="subjectName">ÎœÎ¬Î¸Î·Î¼Î±</label>
              <input type="text" id="subjectName" placeholder="Ï€.Ï‡. ÎœÎ±Î¸Î·Î¼Î±Ï„Î¹ÎºÎ¬" required>
            </div>
            <div class="form-group" style="margin-bottom: 0; flex: 1; min-width: 100px;">
              <label for="subjectCode">ÎšÏ‰Î´Î¹ÎºÏŒÏ‚</label>
              <input type="text" id="subjectCode" placeholder="Ï€.Ï‡. ÎœÎ³4" required>
            </div>
            <div class="form-group" style="margin-bottom: 0; flex: 1; min-width: 120px;">
              <label for="subjectClass">Î¤Î¬Î¾Î·</label>
              <select id="subjectClass" required>
                <option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ</option>
                <option value="Î‘' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…">Î‘' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…</option>
                <option value="Î’' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…">Î’' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…</option>
                <option value="Î“' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…">Î“' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…</option>
                <option value="Î‘' Î›Ï…ÎºÎµÎ¯Î¿Ï…">Î‘' Î›Ï…ÎºÎµÎ¯Î¿Ï…</option>
                <option value="Î’' Î›Ï…ÎºÎµÎ¯Î¿Ï…">Î’' Î›Ï…ÎºÎµÎ¯Î¿Ï…</option>
                <option value="Î“' Î›Ï…ÎºÎµÎ¯Î¿Ï…">Î“' Î›Ï…ÎºÎµÎ¯Î¿Ï…</option>
              </select>
            </div>
            <div class="form-group" style="margin-bottom: 0; flex: 1; min-width: 150px;">
              <label for="subjectTeacher">ÎšÎ±Î¸Î·Î³Î·Ï„Î®Ï‚</label>
              <select id="subjectTeacher" required>
                <option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ ÎºÎ±Î¸Î·Î³Î·Ï„Î®</option>
              </select>
            </div>
            <button type="submit" class="btn btn-success" style="margin-bottom: 0;">Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ·</button>
          </form>
        </div>

        <div>
          <h3>Î¥Ï€Î¬ÏÏ‡Î¿Î½Ï„Î± Î¤Î¼Î®Î¼Î±Ï„Î±</h3>
          <div class="students-table">
            <table>
              <thead>
                <tr>
                  <th>ÎœÎ¬Î¸Î·Î¼Î±</th>
                  <th>ÎšÏ‰Î´Î¹ÎºÏŒÏ‚</th>
                  <th>Î¤Î¬Î¾Î·</th>
                  <th>ÎšÎ±Î¸Î·Î³Î·Ï„Î®Ï‚</th>
                  <th>Î•Î³Î³ÎµÎ³ÏÎ±Î¼Î¼Î­Î½Î¿Î¹</th>
                  <th>Î•Î½Î­ÏÎ³ÎµÎ¹ÎµÏ‚</th>
                </tr>
              </thead>
              <tbody id="subjectsTableBody">
                <!-- Subjects will be loaded here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Student Enrollments Modal -->
    <div id="enrollmentsModal" class="modal">
      <div class="modal-content" style="max-width: 700px;">
        <span class="close" onclick="closeEnrollmentsModal()">&times;</span>
        <h2 id="enrollmentsTitle">Î•Î³Î³ÏÎ±Ï†Î­Ï‚ ÎœÎ±Î¸Î·Ï„Î®</h2>
        
        <div style="margin-bottom: 20px;">
          <h3>Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÏƒÎµ Î¤Î¼Î®Î¼Î±</h3>
          <form id="enrollmentForm" style="display: flex; gap: 10px; align-items: end;">
            <input type="hidden" id="enrollmentStudentId">
            <div class="form-group" style="margin-bottom: 0; flex: 1;">
              <label for="enrollmentSubject">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î¤Î¼Î®Î¼Î±</label>
              <select id="enrollmentSubject" required>
                <option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï„Î¼Î®Î¼Î±</option>
              </select>
            </div>
            <button type="submit" class="btn btn-success" style="margin-bottom: 0;">Î•Î³Î³ÏÎ±Ï†Î®</button>
          </form>
        </div>

        <div>
          <h3>Î¤ÏÎ­Ï‡Î¿Ï…ÏƒÎµÏ‚ Î•Î³Î³ÏÎ±Ï†Î­Ï‚</h3>
          <div class="students-table">
            <table>
              <thead>
                <tr>
                  <th>ÎœÎ¬Î¸Î·Î¼Î±</th>
                  <th>ÎšÏ‰Î´Î¹ÎºÏŒÏ‚</th>
                  <th>Î¤Î¬Î¾Î·</th>
                  <th>ÎšÎ±Î¸Î·Î³Î·Ï„Î®Ï‚</th>
                  <th>Î•Î½Î­ÏÎ³ÎµÎ¹ÎµÏ‚</th>
                </tr>
              </thead>
              <tbody id="enrollmentsTableBody">
                <!-- Enrollments will be loaded here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Subject Modal -->
    <div id="editSubjectModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeEditSubjectModal()">&times;</span>
        <h2>Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Î¤Î¼Î®Î¼Î±Ï„Î¿Ï‚</h2>
        
        <form id="editSubjectForm">
          <input type="hidden" id="editSubjectId">
          
          <div class="form-group">
            <label for="editSubjectName">ÎœÎ¬Î¸Î·Î¼Î±</label>
            <input type="text" id="editSubjectName" required>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="editSubjectCode">ÎšÏ‰Î´Î¹ÎºÏŒÏ‚</label>
              <input type="text" id="editSubjectCode" required>
            </div>
            <div class="form-group">
              <label for="editSubjectClass">Î¤Î¬Î¾Î·</label>
              <select id="editSubjectClass" required>
                <option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ</option>
                <option value="Î‘' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…">Î‘' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…</option>
                <option value="Î’' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…">Î’' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…</option>
                <option value="Î“' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…">Î“' Î“Ï…Î¼Î½Î±ÏƒÎ¯Î¿Ï…</option>
                <option value="Î‘' Î›Ï…ÎºÎµÎ¯Î¿Ï…">Î‘' Î›Ï…ÎºÎµÎ¯Î¿Ï…</option>
                <option value="Î’' Î›Ï…ÎºÎµÎ¯Î¿Ï…">Î’' Î›Ï…ÎºÎµÎ¯Î¿Ï…</option>
                <option value="Î“' Î›Ï…ÎºÎµÎ¯Î¿Ï…">Î“' Î›Ï…ÎºÎµÎ¯Î¿Ï…</option>
              </select>
            </div>
          </div>
          
          <div class="form-group">
            <label for="editSubjectTeacher">ÎšÎ±Î¸Î·Î³Î·Ï„Î®Ï‚</label>
            <select id="editSubjectTeacher" required>
              <option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ ÎºÎ±Î¸Î·Î³Î·Ï„Î®</option>
            </select>
          </div>

          <div style="text-align: center; margin-top: 30px;">
            <button type="button" class="btn btn-primary" onclick="closeEditSubjectModal()">Î‘ÎºÏÏÏ‰ÏƒÎ·</button>
            <button type="submit" class="btn btn-success">Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Add/Edit Teacher Modal -->
    <div id="teacherModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeTeacherModal()">&times;</span>
        <h2 id="teacherModalTitle">Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎÎ­Î¿Ï… ÎšÎ±Î¸Î·Î³Î·Ï„Î®</h2>
        
        <form id="teacherForm">
          <input type="hidden" id="teacherId">
          
          <div class="form-row">
            <div class="form-group">
              <label for="teacherName">ÎŒÎ½Î¿Î¼Î± *</label>
              <input type="text" id="teacherName" required placeholder="Ï€.Ï‡. Î”Ï. ÎœÎ±ÏÎ¯Î± Î‘Î½Ï„Ï‰Î½Î¯Î¿Ï…">
            </div>
            <div class="form-group">
              <label for="teacherSubject">Î•Î¹Î´Î¹ÎºÏŒÏ„Î·Ï„Î± *</label>
              <select id="teacherSubject" required>
                <option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ ÎµÎ¹Î´Î¹ÎºÏŒÏ„Î·Ï„Î±</option>
                <option value="ÎœÎ±Î¸Î·Î¼Î±Ï„Î¹ÎºÎ¬">ÎœÎ±Î¸Î·Î¼Î±Ï„Î¹ÎºÎ¬</option>
                <option value="Î¦Ï…ÏƒÎ¹ÎºÎ®">Î¦Ï…ÏƒÎ¹ÎºÎ®</option>
                <option value="Î§Î·Î¼ÎµÎ¯Î±">Î§Î·Î¼ÎµÎ¯Î±</option>
                <option value="Î’Î¹Î¿Î»Î¿Î³Î¯Î±">Î’Î¹Î¿Î»Î¿Î³Î¯Î±</option>
                <option value="Î™ÏƒÏ„Î¿ÏÎ¯Î±">Î™ÏƒÏ„Î¿ÏÎ¯Î±</option>
                <option value="Î‘ÏÏ‡Î±Î¯Î±">Î‘ÏÏ‡Î±Î¯Î±</option>
                <option value="ÎÎ­Î± Î•Î»Î»Î·Î½Î¹ÎºÎ¬">ÎÎ­Î± Î•Î»Î»Î·Î½Î¹ÎºÎ¬</option>
                <option value="Î†Î»Î³ÎµÎ²ÏÎ±">Î†Î»Î³ÎµÎ²ÏÎ±</option>
                <option value="Î“ÎµÏ‰Î¼ÎµÏ„ÏÎ¯Î±">Î“ÎµÏ‰Î¼ÎµÏ„ÏÎ¯Î±</option>
                <option value="Î“ÎµÏ‰Î³ÏÎ±Ï†Î¯Î±">Î“ÎµÏ‰Î³ÏÎ±Ï†Î¯Î±</option>
                <option value="ÎŸÎ¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÎ¬">ÎŸÎ¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÎ¬</option>
                <option value="Î‘Î³Î³Î»Î¹ÎºÎ¬">Î‘Î³Î³Î»Î¹ÎºÎ¬</option>
                <option value="Î“Î±Î»Î»Î¹ÎºÎ¬">Î“Î±Î»Î»Î¹ÎºÎ¬</option>
                <option value="Î“ÎµÏÎ¼Î±Î½Î¹ÎºÎ¬">Î“ÎµÏÎ¼Î±Î½Î¹ÎºÎ¬</option>
                <option value="Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¹ÎºÎ®">Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¹ÎºÎ®</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="teacherPhone">Î¤Î·Î»Î­Ï†Ï‰Î½Î¿</label>
              <input type="tel" id="teacherPhone" placeholder="Ï€.Ï‡. 6901234567">
            </div>
            <div class="form-group">
              <label for="teacherEmail">Email</label>
              <input type="email" id="teacherEmail" placeholder="Ï€.Ï‡. maria@mathsteki.gr">
            </div>
          </div>

          <div style="text-align: center; margin-top: 30px;">
            <button type="button" class="btn btn-primary" onclick="closeTeacherModal()">Î‘ÎºÏÏÏ‰ÏƒÎ·</button>
            <button type="submit" class="btn btn-success">Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·</button>
          </div>
        </form>
      </div>
    </div>

  </main>

  <footer>
    <div class="footer-content">
      <div class="footer-logo">ÎœÎ±Î¸Î·Ï„Î¹ÎºÏŒ Î£Ï„Î­ÎºÎ¹</div>
      <div class="footer-links">
        <span>ÎšÎ±Î¸Î·Î³Î·Ï„Î­Ï‚:</span>
        <span>...</span>
      </div>
      <div class="footer-map">
        <img src="map.png" alt="Î§Î¬ÏÏ„Î·Ï‚">
      </div>
    </div>
    <div class="footer-bottom">
      &copy; 2025 ÎœÎ±Î¸Î·Ï„Î¹ÎºÏŒ Î£Ï„Î­ÎºÎ¹
    </div>
  </footer>

  <script>
    // Data variables - will be loaded from API
    let students = [];
    let filteredStudents = [];
    let subjects = []; // Will be loaded from Classes table
    let enrollments = []; // Will be loaded from Enrollments table
    let teachers = []; // Will be loaded from Teachers API
    let enrollmentFormSubmitting = false; // Flag to prevent double submission

    // Load all data from API
    async function loadAllData() {
      try {
        await Promise.all([
          loadStudentsFromAPI(),
          loadClassesFromAPI(),
          loadEnrollmentsFromAPI(),
          loadTeachersFromAPI()
        ]);
        console.log('All data loaded successfully');
        
        // Initialize displays after data is loaded
        initializeSubjectsDisplay();
        initializeTeachersDisplay();
        loadTeachersDropdown(); // Load teachers into dropdown after data is loaded
        
      } catch (error) {
        console.error('Error loading data:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½: ' + error.message, 'error');
      }
    }

    // Load teachers from API
    async function loadTeachersFromAPI() {
      try {
        const response = await fetch('/api/teachers');
        if (!response.ok) {
          throw new Error('Failed to fetch teachers');
        }
        const teachersData = await response.json();
        
        // Convert API data to match the expected format
        teachers = teachersData.map(teacher => ({
          id: teacher.id,
          name: teacher.name,
          subject: teacher.subject,
          phone: teacher.phone,
          email: teacher.email
        }));
        
        console.log('Loaded teachers from API:', teachers);
      } catch (error) {
        console.error('Error loading teachers from API:', error);
        // Fallback to hardcoded data
        teachers = [
          { id: 1, name: "Î”Ï. ÎœÎ±ÏÎ¯Î± Î‘Î½Ï„Ï‰Î½Î¯Î¿Ï…", subject: "ÎœÎ±Î¸Î·Î¼Î±Ï„Î¹ÎºÎ¬", phone: "6901234567", email: "maria.antoniou@mathsteki.gr" },
          { id: 2, name: "ÎšÏÏƒÏ„Î±Ï‚ Î“ÎµÏ‰ÏÎ³Î¯Î¿Ï…", subject: "Î¦Ï…ÏƒÎ¹ÎºÎ®", phone: "6902345678", email: "kostas.georgiou@mathsteki.gr" },
          { id: 3, name: "Î•Î»Î­Î½Î· Î Î±Ï€Î±Î´Î¬ÎºÎ·", subject: "Î§Î·Î¼ÎµÎ¯Î±", phone: "6903456789", email: "eleni.papadaki@mathsteki.gr" },
          { id: 4, name: "Î“Î¹Î¬Î½Î½Î·Ï‚ ÎÎ¹ÎºÎ¿Î»Î¬Î¿Ï…", subject: "Î‘ÏÏ‡Î±Î¯Î±", phone: "6904567890", email: "giannis.nikolaou@mathsteki.gr" },
          { id: 5, name: "Î†Î½Î½Î± ÎšÏ‰Î½ÏƒÏ„Î±Î½Ï„Î¯Î½Î¿Ï…", subject: "ÎÎ­Î± Î•Î»Î»Î·Î½Î¹ÎºÎ¬", phone: "6905678901", email: "anna.konstantinou@mathsteki.gr" }
        ];
      }
    }

    // Load classes from API (these are our "subjects")
    async function loadClassesFromAPI() {
      console.log(' loadClassesFromAPI() called');
      try {
        console.log(' Fetching /api/subjects...');
        const response = await fetch('/api/subjects');
        console.log(' Response received:', response.status, response.ok);
        
        if (!response.ok) {
          throw new Error('Failed to fetch subjects');
        }
        const subjectsData = await response.json();
        
        console.log('Raw subjects data from API:', subjectsData);
        console.log('First subject data:', subjectsData[0]);
        
        // Convert API data to match expected format
        subjects = subjectsData.map(subj => {
          console.log('Processing subject:', subj);
          const mappedSubject = {
            id: subj.id,
            name: subj.name,
            code: subj.code,
            class: subj.class,
            teacherId: subj.teacherId,
            teacherName: subj.teacherName
          };
          console.log('Mapped subject:', mappedSubject);
          return mappedSubject;
        });
        
        console.log('Final subjects array:', subjects);
      } catch (error) {
        console.error(' Error loading subjects:', error);
        // Fallback to hardcoded data
        subjects = [
          { id: 1, name: "ÎœÎ±Î¸Î·Î¼Î±Ï„Î¹ÎºÎ¬", code: "ÎœÎ³4", class: "Î“' Î›Ï…ÎºÎµÎ¯Î¿Ï…", teacherId: 1, teacherName: "Î”Ï. ÎœÎ±ÏÎ¯Î± Î‘Î½Ï„Ï‰Î½Î¯Î¿Ï…" },
          { id: 2, name: "Î§Î·Î¼ÎµÎ¯Î±", code: "Î§Î³2", class: "Î“' Î›Ï…ÎºÎµÎ¯Î¿Ï…", teacherId: 3, teacherName: "Î•Î»Î­Î½Î· Î Î±Ï€Î±Î´Î¬ÎºÎ·" }
        ];
        console.log('Using fallback subjects:', subjects);
      }
    }

    // Load enrollments from API
    async function loadEnrollmentsFromAPI() {
      try {
        console.log(' Loading enrollments from API...');
        const response = await fetch('/api/enrollments');
        if (!response.ok) {
          throw new Error('Failed to fetch enrollments');
        }
        const enrollmentsData = await response.json();
        
        console.log('Raw enrollments data from API:', enrollmentsData);
        
        // Convert enrollments format - use the correct field names from the API response
        enrollments = enrollmentsData.map(enr => ({
          enrollment_id: enr.enrollment_id,
          student_id: enr.student_id,
          class_id: enr.class_id, // This is the subject ID for our purposes
          student_name: enr.student_name,
          student_class: enr.student_class,
          subject_name: enr.subject_name,
          subject_code: enr.subject_code,
          teacher_name: enr.teacher_name,
          enrollment_date: new Date().toISOString().split('T')[0] // Default date since not in API response
        }));
        
        console.log(' Converted enrollments:', enrollments);
      } catch (error) {
        console.error(' Error loading enrollments:', error);
        // Keep existing enrollments on error
        console.log('Using existing enrollments:', enrollments);
      }
    }

    // Load students from API
    async function loadStudentsFromAPI() {
      try {
        const response = await fetch('/api/students');
        const studentsData = await response.json();
        
        // Convert API data to match the expected format
        students = studentsData.map(student => ({
          id: student.id,
          firstName: student.first_name,
          lastName: student.last_name,
          username: student.username, // Important for linking to profile
          studentClass: student.class,
          phone: student.phone,
          email: student.email,
          parentName: student.parentName,
          parentPhone: student.parentPhone,
          address: student.address,
          birthDate: student.birthDate ? new Date(student.birthDate).toISOString().split('T')[0] : '',
          enrollmentDate: student.enrollmentDate ? new Date(student.enrollmentDate).toISOString().split('T')[0] : '',
          status: student.status,
          notes: student.notes || ''
        }));
        
        filteredStudents = [...students];
        loadStudents(); // Refresh the table
        
        console.log('Loaded students from API:', students);
      } catch (error) {
        console.error('Error loading students from API:', error);
        // Fallback to mock data if API fails
        students = [
          {
            id: 1,
            firstName: "Î“Î¹Î¬Î½Î½Î·Ï‚",
            lastName: "Î Î±Ï€Î±Î´ÏŒÏ€Î¿Ï…Î»Î¿Ï‚",
            username: "giannisp",
            studentClass: "Î’' Î›Ï…ÎºÎµÎ¯Î¿Ï…",
            phone: "6901234567",
            email: "giannis@example.com",
            parentName: "ÎšÏÏƒÏ„Î±Ï‚ Î Î±Ï€Î±Î´ÏŒÏ€Î¿Ï…Î»Î¿Ï‚",
            parentPhone: "6907654321",
            address: "Î›ÎµÏ‰Ï†. ÎšÎ·Ï†Î¹ÏƒÎ¯Î±Ï‚ 123, Î‘Î¸Î®Î½Î±",
            birthDate: "2007-03-15",
            enrollmentDate: "2023-09-01",
            status: "active",
            notes: "Î Î¿Î»Ï ÎºÎ±Î»ÏŒÏ‚ Î¼Î±Î¸Î·Ï„Î®Ï‚, ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎµÏ„Î±Î¹ Î³Î¹Î± Ï„Î± Î¼Î±Î¸Î·Î¼Î±Ï„Î¹ÎºÎ¬"
          }
        ];
        filteredStudents = [...students];
        loadStudents();
      }
    }

    // Load students on page load
    document.addEventListener('DOMContentLoaded', function() {
      console.log(' DOM Content Loaded - Starting data loading...');
      loadAllData(); // Load all data from API
      
      // Set today's date as default for enrollment date
      document.getElementById('enrollmentDate').value = new Date().toISOString().split('T')[0];
    });

    // Load teachers into dropdown
    function loadTeachersDropdown() {
      const select = document.getElementById('subjectTeacher');
      select.innerHTML = '<option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ ÎºÎ±Î¸Î·Î³Î·Ï„Î®</option>';
      
      teachers.forEach(teacher => {
        const option = document.createElement('option');
        option.value = teacher.id;
        option.textContent = `${teacher.name} (${teacher.subject})`;
        select.appendChild(option);
      });
    }

    // Search functionality
    function searchStudents() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const classFilter = document.getElementById('classFilter').value;

      filteredStudents = students.filter(student => {
        const matchesSearch = !searchTerm || 
          student.firstName.toLowerCase().includes(searchTerm) ||
          student.lastName.toLowerCase().includes(searchTerm) ||
          student.phone.includes(searchTerm) ||
          (student.email && student.email.toLowerCase().includes(searchTerm));

        const matchesClass = !classFilter || student.studentClass === classFilter;

        return matchesSearch && matchesClass;
      });

      loadStudents();
    }

    // Load students into table
    function loadStudents() {
      const tbody = document.getElementById('studentsTableBody');
      tbody.innerHTML = '';

      if (filteredStudents.length === 0) {
        tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 30px;">Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ Î¼Î±Î¸Î·Ï„Î­Ï‚</td></tr>';
        return;
      }

      filteredStudents.forEach(student => {
        // Get student's enrollments
        const studentEnrollments = enrollments.filter(e => e.student_id === student.id);
        const enrollmentTexts = studentEnrollments.map(enrollment => {
          const subject = subjects.find(s => s.id === enrollment.class_id);
          const teacher = teachers.find(t => t.id === (subject ? subject.teacherId : null));
          
          if (subject) {
            const teacherInfo = teacher ? ` - ${teacher.name}` : ' - Î”ÎµÎ½ Î­Ï‡ÎµÎ¹ ÎºÎ±Î¸Î·Î³Î·Ï„Î®';
            return `${subject.name} ${subject.code}${teacherInfo}`;
          }
          return '';
        }).filter(text => text);
        
        const enrollmentsDisplay = enrollmentTexts.length > 0 ? 
          enrollmentTexts.join('<br>') : 
          '<span style="color: #888;">Î§Ï‰ÏÎ¯Ï‚ ÎµÎ³Î³ÏÎ±Ï†Î­Ï‚</span>';

        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${student.id}</td>
          <td>${student.firstName}</td>
          <td>${student.lastName}</td>
          <td>${student.studentClass}</td>
          <td>${enrollmentsDisplay}</td>
          <td>${student.phone}</td>
          <td>${student.email || '-'}</td>
          <td>${formatDate(student.enrollmentDate)}</td>
          <td>
            <div class="action-buttons">
              <button class="btn btn-primary btn-small" onclick="viewStudent(${student.id})">Î ÏÎ¿Î²Î¿Î»Î®</button>
              <button class="btn btn-info btn-small" onclick="viewStudentProfile(${student.id})" title="Î”ÎµÏ‚ Ï„Î·Î½ ÎºÎ±ÏÏ„Î­Î»Î± Î¼Î±Î¸Î·Ï„Î®">ÎšÎ±ÏÏ„Î­Î»Î±</button>
              <button class="btn btn-primary btn-small" onclick="editStudent(${student.id})">Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±</button>
              <button class="btn btn-success btn-small" onclick="manageEnrollments(${student.id})">Î¤Î¼Î®Î¼Î±Ï„Î±</button>
              <button class="btn btn-danger btn-small" onclick="deleteStudent(${student.id})">Î”Î¹Î±Î³ÏÎ±Ï†Î®</button>
            </div>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    // Format date for display
    function formatDate(dateString) {
      if (!dateString) return '-';
      const date = new Date(dateString);
      return date.toLocaleDateString('el-GR');
    }

    // Modal functions
    function openAddModal() {
      document.getElementById('modalTitle').textContent = 'Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎÎ­Î¿Ï… ÎœÎ±Î¸Î·Ï„Î®';
      document.getElementById('studentForm').reset();
      document.getElementById('studentId').value = '';
      document.getElementById('enrollmentDate').value = new Date().toISOString().split('T')[0];
      document.getElementById('status').value = 'active';
      
      // Clear username and password fields
      document.getElementById('username').value = '';
      document.getElementById('password').value = '';
      
      document.getElementById('studentModal').style.display = 'block';
    }

    function editStudent(id) {
      const student = students.find(s => s.id === id);
      if (!student) return;

      document.getElementById('modalTitle').textContent = 'Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± ÎœÎ±Î¸Î·Ï„Î®';
      document.getElementById('studentId').value = student.id;
      document.getElementById('firstName').value = student.firstName;
      document.getElementById('lastName').value = student.lastName;
      document.getElementById('studentClass').value = student.studentClass;
      document.getElementById('phone').value = student.phone;
      document.getElementById('email').value = student.email || '';
      document.getElementById('parentName').value = student.parentName || '';
      document.getElementById('parentPhone').value = student.parentPhone || '';
      document.getElementById('address').value = student.address || '';
      document.getElementById('birthDate').value = student.birthDate || '';
      document.getElementById('enrollmentDate').value = student.enrollmentDate || '';
      document.getElementById('status').value = student.status || 'active';
      document.getElementById('notes').value = student.notes || '';
      
      document.getElementById('studentModal').style.display = 'block';
    }

    function viewStudent(id) {
      const student = students.find(s => s.id === id);
      if (!student) return;

      const content = document.getElementById('studentDetailsContent');
      content.innerHTML = `
        <div class="student-details">
          <h3>${student.firstName} ${student.lastName}</h3>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
            <div><strong>Î¤Î¬Î¾Î·:</strong> ${student.studentClass}</div>
            <div><strong>ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·:</strong> ${getStatusText(student.status)}</div>
            <div><strong>Î¤Î·Î»Î­Ï†Ï‰Î½Î¿:</strong> ${student.phone}</div>
            <div><strong>Email:</strong> ${student.email || '-'}</div>
            <div><strong>Î—Î¼. Î“Î­Î½Î½Î·ÏƒÎ·Ï‚:</strong> ${formatDate(student.birthDate)}</div>
            <div><strong>Î—Î¼. Î•Î³Î³ÏÎ±Ï†Î®Ï‚:</strong> ${formatDate(student.enrollmentDate)}</div>
            <div><strong>Î“Î¿Î½Î­Î±Ï‚:</strong> ${student.parentName || '-'}</div>
            <div><strong>Î¤Î·Î». Î“Î¿Î½Î­Î±:</strong> ${student.parentPhone || '-'}</div>
          </div>
          ${student.address ? `<div style="margin-top: 15px;"><strong>Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·:</strong><br>${student.address}</div>` : ''}
          ${student.notes ? `<div style="margin-top: 15px;"><strong>Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚:</strong><br>${student.notes}</div>` : ''}
          <div style="margin-top: 20px; text-align: center;">
            ${student.username ? 
              `<button class="btn btn-info" onclick="viewStudentProfile(${student.id})" style="margin-right: 10px;">
                  Î”ÎµÏ‚ ÎšÎ±ÏÏ„Î­Î»Î± ÎœÎ±Î¸Î·Ï„Î®
               </button>` : 
              `<span style="color: #888; font-style: italic;">Î”ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î· ÎºÎ±ÏÏ„Î­Î»Î± (Ï‡Ï‰ÏÎ¯Ï‚ username)</span>`
            }
            <button class="btn btn-primary" onclick="editStudent(${student.id})">
               Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±
            </button>
          </div>
        </div>
      `;
      
      document.getElementById('viewStudentModal').style.display = 'block';
    }

    function getStatusText(status) {
      switch(status) {
        case 'active': return 'Î•Î½ÎµÏÎ³ÏŒÏ‚';
        case 'inactive': return 'Î‘Î½ÎµÎ½ÎµÏÎ³ÏŒÏ‚';
        case 'graduated': return 'Î‘Ï€ÏŒÏ†Î¿Î¹Ï„Î¿Ï‚';
        default: return status;
      }
    }

    function closeModal() {
      document.getElementById('studentModal').style.display = 'none';
    }

    function closeViewModal() {
      document.getElementById('viewStudentModal').style.display = 'none';
    }

    function deleteStudent(id) {
      const student = students.find(s => s.id === id);
      if (!student) return;

      if (confirm(`Î•Î¯ÏƒÏ„Îµ Î²Î­Î²Î±Î¹Î¿Î¹ ÏŒÏ„Î¹ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ Ï„Î¿Î½ Î¼Î±Î¸Î·Ï„Î® ${student.firstName} ${student.lastName};`)) {
        students = students.filter(s => s.id !== id);
        filteredStudents = filteredStudents.filter(s => s.id !== id);
        loadStudents();
        showAlert('ÎŸ Î¼Î±Î¸Î·Ï„Î®Ï‚ Î´Î¹Î±Î³ÏÎ¬Ï†Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!', 'success');
      }
    }

    // Function to view student profile in student-tablet.html
    function viewStudentProfile(studentId) {
      const student = students.find(s => s.id === studentId);
      if (!student) {
        alert('ÎœÎ±Î¸Î·Ï„Î®Ï‚ Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ');
        return;
      }
      
      // Check if student has username
      if (!student.username) {
        alert('ÎŸ Î¼Î±Î¸Î·Ï„Î®Ï‚ Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ username. Î Î±ÏÎ±ÎºÎ±Î»Ï Î¿ÏÎ¯ÏƒÏ„Îµ username Ï€ÏÏÏ„Î±.');
        return;
      }
      
      // Open student profile in new tab/window
      const studentProfileUrl = `student-tablet.html?username=${encodeURIComponent(student.username)}`;
      window.open(studentProfileUrl, '_blank');
    }

    // Form submission
    document.getElementById('studentForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const studentData = {
        firstName: document.getElementById('firstName').value,
        lastName: document.getElementById('lastName').value,
        studentClass: document.getElementById('studentClass').value,
        phone: document.getElementById('phone').value,
        email: document.getElementById('email').value,
        username: document.getElementById('username').value,
        password: document.getElementById('password').value,
        parentName: document.getElementById('parentName').value,
        parentPhone: document.getElementById('parentPhone').value,
        address: document.getElementById('address').value,
        birthDate: document.getElementById('birthDate').value,
        registrationDate: document.getElementById('enrollmentDate').value,
        status: document.getElementById('status').value,
        notes: document.getElementById('notes').value
      };

      const studentId = document.getElementById('studentId').value;

      try {
        if (studentId) {
          // Edit existing student
          const response = await fetch(`/api/students/${studentId}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(studentData)
          });
          
          if (response.ok) {
            showAlert('Î¤Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± Ï„Î¿Ï… Î¼Î±Î¸Î·Ï„Î® ÎµÎ½Î·Î¼ÎµÏÏÎ¸Î·ÎºÎ±Î½ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!', 'success');
          } else {
            const error = await response.json();
            showAlert(error.error || 'Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ·', 'error');
          }
        } else {
          // Add new student
          console.log(' Sending student data:', studentData);
          
          const response = await fetch('/api/students', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(studentData)
          });
          
          if (response.ok) {
            const result = await response.json();
            console.log(' Student created:', result);
            showAlert('ÎŸ Î½Î­Î¿Ï‚ Î¼Î±Î¸Î·Ï„Î®Ï‚ Ï€ÏÎ¿ÏƒÏ„Î­Î¸Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!', 'success');
          } else {
            const error = await response.json();
            console.error(' Error creating student:', error);
            showAlert(error.error || 'Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Ï€ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î¼Î±Î¸Î·Ï„Î®', 'error');
          }
        }

        closeModal();
        await loadStudentsFromAPI(); // Refresh the list from server
      } catch (error) {
        console.error(' Network error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± Î´Î¹ÎºÏ„ÏÎ¿Ï…. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.', 'error');
      }
    });

    // Show alert messages
    function showAlert(message, type) {
      const alertElement = type === 'success' ? 
        document.getElementById('alertSuccess') : 
        document.getElementById('alertError');
      
      alertElement.textContent = message;
      alertElement.style.display = 'block';
      
      setTimeout(() => {
        alertElement.style.display = 'none';
      }, 5000);
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
      const modal = document.getElementById('studentModal');
      const viewModal = document.getElementById('viewStudentModal');
      if (event.target === modal) {
        closeModal();
      }
      if (event.target === viewModal) {
        closeViewModal();
      }
    }

    // Search on Enter key
    document.getElementById('searchInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        searchStudents();
      }
    });

    // Auto search on input change
    document.getElementById('searchInput').addEventListener('input', searchStudents);
    document.getElementById('classFilter').addEventListener('change', searchStudents);

    // ===== SUBJECTS SEARCH AND DISPLAY =====
    
    let filteredSubjects = [];

    // Search functionality for subjects
    function searchSubjects() {
      const searchTerm = document.getElementById('subjectSearchInput').value.toLowerCase();
      const classFilter = document.getElementById('subjectClassFilter').value;

      filteredSubjects = subjects.filter(subject => {
        const teacher = teachers.find(t => t.id === subject.teacherId);
        const teacherName = teacher ? teacher.name.toLowerCase() : '';
        const teacherSubject = teacher ? teacher.subject.toLowerCase() : '';
        
        const matchesSearch = !searchTerm || 
          subject.name.toLowerCase().includes(searchTerm) ||
          subject.code.toLowerCase().includes(searchTerm) ||
          teacherName.includes(searchTerm) ||
          teacherSubject.includes(searchTerm);

        const matchesClass = !classFilter || subject.class === classFilter;

        return matchesSearch && matchesClass;
      });

      loadFilteredSubjects();
    }

    // Load filtered subjects into table
    function loadFilteredSubjects() {
      const tbody = document.getElementById('subjectsTableBody');
      tbody.innerHTML = '';

      if (filteredSubjects.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 30px;">Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ Ï„Î¼Î®Î¼Î±Ï„Î±</td></tr>';
        return;
      }

      filteredSubjects.forEach(subject => {
        const enrolledCount = enrollments.filter(e => e.class_id === subject.id).length;
        const teacher = teachers.find(t => t.id === subject.teacherId);
        const teacherName = teacher ? teacher.name : 'Î”ÎµÎ½ Î­Ï‡ÎµÎ¹ Î±Î½Î±Ï„ÎµÎ¸ÎµÎ¯';
        
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${subject.name}</td>
          <td>${subject.code}</td>
          <td>${subject.class}</td>
          <td>${teacherName}</td>
          <td>${enrolledCount}</td>
          <td>
            <div class="action-buttons">
              <button class="btn btn-primary btn-small" onclick="editSubject(${subject.id})">Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±</button>
              <button class="btn btn-danger btn-small" onclick="deleteSubject(${subject.id})">Î”Î¹Î±Î³ÏÎ±Ï†Î®</button>
              <button class="btn btn-info btn-small" onclick="viewSubjectDetails(${subject.id})">Î›ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚</button>
            </div>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    // Initialize subjects display when data is loaded
    function initializeSubjectsDisplay() {
      filteredSubjects = [...subjects];
      loadFilteredSubjects();
    }

    // Add event listeners for subjects search
    document.addEventListener('DOMContentLoaded', function() {
      // ...existing code...
      
      // Subjects search functionality
      document.getElementById('subjectSearchInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          searchSubjects();
        }
      });

      document.getElementById('subjectSearchInput').addEventListener('input', searchSubjects);
      document.getElementById('subjectClassFilter').addEventListener('change', searchSubjects);
    });

    // Open add subject modal
    function openAddSubjectModal() {
      loadSubjectTeachersDropdown();
      initializeSubjectsDisplay();
      document.getElementById('subjectsModal').style.display = 'block';
    }

    // Open subjects modal (general)
    function openSubjectsModal() {
      loadSubjectTeachersDropdown();
      initializeSubjectsDisplay();
      document.getElementById('subjectsModal').style.display = 'block';
    }

    // Close subjects modal
    function closeSubjectsModal() {
      document.getElementById('subjectsModal').style.display = 'none';
    }

    // Load teachers dropdown for subject creation
    function loadSubjectTeachersDropdown() {
      const select = document.getElementById('subjectTeacher');
      select.innerHTML = '<option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ ÎºÎ±Î¸Î·Î³Î·Ï„Î®</option>';
      
      teachers.forEach(teacher => {
        const option = document.createElement('option');
        option.value = teacher.id;
        option.textContent = `${teacher.name} (${teacher.subject})`;
        select.appendChild(option);
      });
    }

    // View subject details
    function viewSubjectDetails(subjectId) {
      const subject = subjects.find(s => s.id === subjectId);
      if (!subject) return;

      const teacher = teachers.find(t => t.id === subject.teacherId);
      const enrolledStudents = enrollments.filter(e => e.class_id === subjectId);
      
      let studentsList = '';
      if (enrolledStudents.length > 0) {
        enrolledStudents.forEach(enrollment => {
          const student = students.find(s => s.id === enrollment.student_id);
          if (student) {
            studentsList += `<li>${student.firstName} ${student.lastName} (${student.studentClass})</li>`;
          }
        });
      } else {
        studentsList = '<li>Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎµÎ³Î³ÎµÎ³ÏÎ±Î¼Î¼Î­Î½Î¿Î¹ Î¼Î±Î¸Î·Ï„Î­Ï‚</li>';
      }

      const detailsHtml = `
        <h3>Î›ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚ Î¤Î¼Î®Î¼Î±Ï„Î¿Ï‚</h3>
        <p><strong>ÎœÎ¬Î¸Î·Î¼Î±:</strong> ${subject.name}</p>
        <p><strong>ÎšÏ‰Î´Î¹ÎºÏŒÏ‚:</strong> ${subject.code}</p>
        <p><strong>Î¤Î¬Î¾Î·:</strong> ${subject.class}</p>
        <p><strong>ÎšÎ±Î¸Î·Î³Î·Ï„Î®Ï‚:</strong> ${teacher ? teacher.name : 'Î”ÎµÎ½ Î­Ï‡ÎµÎ¹ Î±Î½Î±Ï„ÎµÎ¸ÎµÎ¯'}</p>
        <p><strong>Î•Î¹Î´Î¹ÎºÏŒÏ„Î·Ï„Î±:</strong> ${teacher ? teacher.subject : '-'}</p>
        <p><strong>Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ ÎœÎ±Î¸Î·Ï„ÏÎ½:</strong> ${enrolledStudents.length}</p>
        <h4>Î•Î³Î³ÎµÎ³ÏÎ±Î¼Î¼Î­Î½Î¿Î¹ ÎœÎ±Î¸Î·Ï„Î­Ï‚:</h4>
        <ul>${studentsList}</ul>
      `;

      // Show in a simple alert for now - could be enhanced with a proper modal
      alert(detailsHtml.replace(/<[^>]*>/g, '\n').replace(/\n+/g, '\n'));
    }

    // ===== ENROLLMENTS MANAGEMENT =====
    
    function manageEnrollments(studentId) {
      console.log(' Managing enrollments for student:', studentId);
      const student = students.find(s => s.id === studentId);
      if (!student) {
        console.error('Student not found:', studentId);
        return;
      }

      console.log('Found student:', student);
      console.log('Current subjects array:', subjects);
      console.log('Current enrollments array:', enrollments);

      document.getElementById('enrollmentsTitle').textContent = `Î•Î³Î³ÏÎ±Ï†Î­Ï‚ - ${student.firstName} ${student.lastName}`;
      document.getElementById('enrollmentStudentId').value = studentId;
      
      loadEnrollmentSubjects();
      loadStudentEnrollments(studentId);
      
      document.getElementById('enrollmentsModal').style.display = 'block';
    }

    function closeEnrollmentsModal() {
      document.getElementById('enrollmentsModal').style.display = 'none';
    }

    function loadEnrollmentSubjects() {
      const select = document.getElementById('enrollmentSubject');
      const studentId = parseInt(document.getElementById('enrollmentStudentId').value);
      
      console.log('Loading enrollment subjects for student:', studentId);
      console.log('Available subjects:', subjects);
      console.log('Current enrollments:', enrollments);
      
      // Get subjects student is already enrolled in
      const enrolledSubjectIds = enrollments
        .filter(e => e.student_id === studentId)
        .map(e => e.class_id); // Use class_id from enrollments (this is the subject ID)
      
      console.log('Enrolled subject IDs:', enrolledSubjectIds);
      
      const availableSubjects = subjects.filter(s => !enrolledSubjectIds.includes(s.id));
      
      console.log('Available subjects for enrollment:', availableSubjects);
      
      select.innerHTML = '<option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï„Î¼Î®Î¼Î±</option>';
      availableSubjects.forEach(subject => {
        console.log('Creating option for subject:', subject);
        const teacher = teachers.find(t => t.id === subject.teacherId);
        const teacherInfo = teacher ? ` - ${teacher.name}` : ' - Î”ÎµÎ½ Î­Ï‡ÎµÎ¹ ÎºÎ±Î¸Î·Î³Î·Ï„Î®';
        
        const option = document.createElement('option');
        option.value = subject.id;
        option.textContent = `${subject.name} ${subject.code} (${subject.class})${teacherInfo}`;
        select.appendChild(option);
        console.log('Added option with value:', option.value, 'text:', option.textContent);
      });
      
      console.log('Dropdown populated with', availableSubjects.length, 'options');
      console.log('Final dropdown HTML:', select.innerHTML);
    }

    function loadStudentEnrollments(studentId) {
      const tbody = document.getElementById('enrollmentsTableBody');
      tbody.innerHTML = '';

      console.log('Loading enrollments for student:', studentId);
      console.log('All enrollments:', enrollments);

      const studentEnrollments = enrollments.filter(e => e.student_id === studentId);
      
      console.log('Filtered student enrollments:', studentEnrollments);
      
      if (studentEnrollments.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 30px;">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎµÎ³Î³ÏÎ±Ï†Î­Ï‚</td></tr>';
        return;
      }

      studentEnrollments.forEach(enrollment => {
        const subject = subjects.find(s => s.id === enrollment.class_id); // Use class_id
        const teacher = teachers.find(t => t.id === (subject ? subject.teacherId : null));
        
        if (!subject) {
          console.warn('Subject not found for class_id:', enrollment.class_id);
          return;
        }

        const teacherName = teacher ? teacher.name : 'Î”ÎµÎ½ Î­Ï‡ÎµÎ¹ Î¿ÏÎ¹ÏƒÏ„ÎµÎ¯ ÎºÎ±Î¸Î·Î³Î·Ï„Î®Ï‚';

        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${subject.name}</td>
          <td>${subject.code}</td>
          <td>${subject.class}</td>
          <td>${teacherName}</td>
          <td>
            <div class="action-buttons">
              <button class="btn btn-danger btn-small" onclick="removeEnrollment(${enrollment.enrollment_id})">Î‘Ï†Î±Î¯ÏÎµÏƒÎ·</button>
            </div>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    async function removeEnrollment(enrollmentId) {
      const enrollment = enrollments.find(e => e.enrollment_id === enrollmentId);
      if (!enrollment) {
        console.error('Enrollment not found:', enrollmentId);
        return;
      }

      const subject = subjects.find(s => s.id === enrollment.class_id);
      const student = students.find(s => s.id === enrollment.student_id);

      if (confirm(`Î•Î¯ÏƒÏ„Îµ Î²Î­Î²Î±Î¹Î¿Î¹ ÏŒÏ„Î¹ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î±Ï†Î±Î¹ÏÎ­ÏƒÎµÏ„Îµ Ï„Î¿Î½ Î¼Î±Î¸Î·Ï„Î® Î±Ï€ÏŒ Ï„Î¿ Ï„Î¼Î®Î¼Î± "${subject?.name} ${subject?.code}";`)) {
        try {
          // API call to delete enrollment
          const response = await fetch(`/api/enrollments/${enrollmentId}`, {
            method: 'DELETE'
          });

          if (response.ok) {
            // Update local data
            enrollments = enrollments.filter(e => e.enrollment_id !== enrollmentId);
            
            loadStudentEnrollments(enrollment.student_id);
            loadEnrollmentSubjects();
            loadStudents(); // Refresh main table
            
            showAlert('Î— ÎµÎ³Î³ÏÎ±Ï†Î® Î±Ï†Î±Î¹ÏÎ­Î¸Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚ Î±Ï€ÏŒ Ï„Î· Î²Î¬ÏƒÎ·!', 'success');
          } else {
            const result = await response.json();
            throw new Error(result.error || 'Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Î±Ï†Î±Î¯ÏÎµÏƒÎ· ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚');
          }
        } catch (error) {
          console.error('Error removing enrollment:', error);
          showAlert('Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Î±Ï†Î±Î¯ÏÎµÏƒÎ·: ' + error.message, 'error');
        }
      }
    }

    // Enrollment form submission
    document.getElementById('enrollmentForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      if (enrollmentFormSubmitting) {
        console.log('Form already submitting, ignoring...');
        return;
      }
      
      enrollmentFormSubmitting = true;
      
      const studentId = parseInt(document.getElementById('enrollmentStudentId').value);
      const subjectId = parseInt(document.getElementById('enrollmentSubject').value);
      
      console.log('Submitting enrollment:', { studentId, subjectId });
      
      if (!subjectId || isNaN(subjectId)) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ Ï„Î¼Î®Î¼Î±!', 'error');
        enrollmentFormSubmitting = false;
        return;
      }

      try {
        // API call to create enrollment
        const response = await fetch('/api/enrollments', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            classId: subjectId, // Note: using classId as per database structure
            studentId: studentId,
            status: 'active'
          })
        });

        const result = await response.json();
        console.log('Enrollment creation result:', result);

        if (response.ok) {
          // Reload enrollments from API to get the updated data
          await loadEnrollmentsFromAPI();
          
          loadStudentEnrollments(studentId);
          loadEnrollmentSubjects();
          loadStudents(); // Refresh main table
          
          this.reset();
          document.getElementById('enrollmentSubject').innerHTML = '<option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï„Î¼Î®Î¼Î±</option>';
          
          showAlert('Î— ÎµÎ³Î³ÏÎ±Ï†Î® Ï€ÏÎ¿ÏƒÏ„Î­Î¸Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚ ÎºÎ±Î¹ Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ ÏƒÏ„Î· Î²Î¬ÏƒÎ·!', 'success');
        } else {
          throw new Error(result.error || 'Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Ï€ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚');
        }
      } catch (error) {
        console.error('Error creating enrollment:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·: ' + error.message, 'error');
      } finally {
        enrollmentFormSubmitting = false; // Reset flag
      }
    });

    // ===== SUBJECT MANAGEMENT FUNCTIONS =====
    
    // Edit subject function
    function editSubject(subjectId) {
      const subject = subjects.find(s => s.id === subjectId);
      if (!subject) {
        console.error('Subject not found:', subjectId);
        return;
      }

      console.log('Editing subject:', subject);
      
      // Populate the form
      document.getElementById('editSubjectId').value = subject.id;
      document.getElementById('editSubjectName').value = subject.name;
      document.getElementById('editSubjectCode').value = subject.code;
      document.getElementById('editSubjectClass').value = subject.class;
      
      // Load teachers into dropdown
      loadEditSubjectTeachersDropdown();
      
      // Set selected teacher
      setTimeout(() => {
        document.getElementById('editSubjectTeacher').value = subject.teacherId || '';
      }, 100);
      
      // Show the modal
      document.getElementById('editSubjectModal').style.display = 'block';
    }

    // Load teachers dropdown for edit subject modal
    function loadEditSubjectTeachersDropdown() {
      const select = document.getElementById('editSubjectTeacher');
      select.innerHTML = '<option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ ÎºÎ±Î¸Î·Î³Î·Ï„Î®</option>';
      
      teachers.forEach(teacher => {
        const option = document.createElement('option');
        option.value = teacher.id;
        option.textContent = `${teacher.name} (${teacher.subject})`;
        select.appendChild(option);
      });
    }

    // Close edit subject modal
    function closeEditSubjectModal() {
      document.getElementById('editSubjectModal').style.display = 'none';
    }

    // Delete subject function
    async function deleteSubject(subjectId) {
      const subject = subjects.find(s => s.id === subjectId);
      if (!subject) {
        console.error('Subject not found:', subjectId);
        return;
      }

      // Check if subject has enrolled students
      const enrolledStudents = enrollments.filter(e => e.class_id === subjectId);
      if (enrolledStudents.length > 0) {
        alert(`Î”ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ Ï„Î¿ Ï„Î¼Î®Î¼Î± "${subject.name}" Î³Î¹Î±Ï„Î¯ Î­Ï‡ÎµÎ¹ ${enrolledStudents.length} ÎµÎ³Î³ÎµÎ³ÏÎ±Î¼Î¼Î­Î½Î¿Ï…Ï‚ Î¼Î±Î¸Î·Ï„Î­Ï‚.`);
        return;
      }

      if (confirm(`Î•Î¯ÏƒÏ„Îµ Î²Î­Î²Î±Î¹Î¿Î¹ ÏŒÏ„Î¹ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ Ï„Î¿ Ï„Î¼Î®Î¼Î± "${subject.name} ${subject.code}";`)) {
        try {
          const response = await fetch(`/api/subjects/${subjectId}`, {
            method: 'DELETE'
          });

          if (response.ok) {
            // Remove from local array
            subjects = subjects.filter(s => s.id !== subjectId);
            filteredSubjects = filteredSubjects.filter(s => s.id !== subjectId);
            
            // Refresh displays
            loadFilteredSubjects();
            loadStudents(); // Refresh students table to update enrollments display
            
            showAlert('Î¤Î¿ Ï„Î¼Î®Î¼Î± Î´Î¹Î±Î³ÏÎ¬Ï†Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!', 'success');
          } else {
            const error = await response.json();
            throw new Error(error.error || 'Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î· Î´Î¹Î±Î³ÏÎ±Ï†Î®');
          }
        } catch (error) {
          console.error('Error deleting subject:', error);
          showAlert('Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î· Î´Î¹Î±Î³ÏÎ±Ï†Î®: ' + error.message, 'error');
        }
      }
    }

    // Handle edit subject form submission
    document.addEventListener('DOMContentLoaded', function() {
      // ...existing code...
      
      // Edit subject form submission
      document.getElementById('editSubjectForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const subjectId = document.getElementById('editSubjectId').value;
        const subjectData = {
          name: document.getElementById('editSubjectName').value,
          code: document.getElementById('editSubjectCode').value,
          class: document.getElementById('editSubjectClass').value,
          teacherId: document.getElementById('editSubjectTeacher').value || null
        };

        try {
          const response = await fetch(`/api/subjects/${subjectId}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(subjectData)
          });

          if (response.ok) {
            // Reload subjects from API to get fresh data
            await loadClassesFromAPI();
            
            // Reload enrollments to get updated teacher names
            await loadEnrollmentsFromAPI();
            
            // Refresh displays
            initializeSubjectsDisplay();
            loadStudents(); // Refresh students table to update enrollments display
            
            closeEditSubjectModal();
            showAlert('Î¤Î¿ Ï„Î¼Î®Î¼Î± ÎµÎ½Î·Î¼ÎµÏÏÎ¸Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!', 'success');
          } else {
            const error = await response.json();
            throw new Error(error.error || 'Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ·');
          }
        } catch (error) {
          console.error('Error updating subject:', error);
          showAlert('Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ·: ' + error.message, 'error');
        }
      });

      // Add subject form submission
      document.getElementById('subjectForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const subjectData = {
          name: document.getElementById('subjectName').value,
          code: document.getElementById('subjectCode').value,
          class: document.getElementById('subjectClass').value,
          teacherId: document.getElementById('subjectTeacher').value || null
        };

        console.log(' Sending subject data:', subjectData);
        console.log(' Form values:');
        console.log('  name:', document.getElementById('subjectName').value);
        console.log('  code:', document.getElementById('subjectCode').value);
        console.log('  class:', document.getElementById('subjectClass').value);
        console.log('  teacherId:', document.getElementById('subjectTeacher').value);

        try {
          const response = await fetch('/api/subjects', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(subjectData)
          });

          if (response.ok) {
            const result = await response.json();
            
            // Add to local subjects array
            const teacher = teachers.find(t => t.id == subjectData.teacherId);
            const newSubject = {
              id: result.id,
              ...subjectData,
              teacherName: teacher ? teacher.name : null,
              enrolledCount: 0
            };
            
            subjects.push(newSubject);
            
            // Refresh displays
            initializeSubjectsDisplay();
            loadStudents(); // Refresh students table
            
            // Reset form
            this.reset();
            loadSubjectTeachersDropdown(); // Reload dropdown after reset
            
            showAlert('Î¤Î¿ Ï„Î¼Î®Î¼Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!', 'success');
          } else {
            const error = await response.json();
            throw new Error(error.error || 'Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±');
          }
        } catch (error) {
          console.error('Error creating subject:', error);
          showAlert('Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±: ' + error.message, 'error');
        }
      });
    });

    // ===== TEACHERS MANAGEMENT =====
    
    let filteredTeachers = [];

    // Search functionality for teachers
    function searchTeachers() {
      const searchTerm = document.getElementById('teacherSearchInput').value.toLowerCase();
      const subjectFilter = document.getElementById('teacherSubjectFilter').value;

      filteredTeachers = teachers.filter(teacher => {
        const matchesSearch = !searchTerm || 
          teacher.name.toLowerCase().includes(searchTerm) ||
          teacher.subject.toLowerCase().includes(searchTerm) ||
          (teacher.email && teacher.email.toLowerCase().includes(searchTerm)) ||
          (teacher.phone && teacher.phone.includes(searchTerm));

        const matchesSubject = !subjectFilter || teacher.subject === subjectFilter;

        return matchesSearch && matchesSubject;
      });

      loadFilteredTeachers();
    }

    // Load filtered teachers into table
    function loadFilteredTeachers() {
      const tbody = document.getElementById('teachersTableBody');
      tbody.innerHTML = '';

      if (filteredTeachers.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 30px;">Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ ÎºÎ±Î¸Î·Î³Î·Ï„Î­Ï‚</td></tr>';
        return;
      }

      filteredTeachers.forEach(teacher => {
        // Find subjects taught by this teacher
        const teacherSubjects = subjects.filter(s => s.teacherId === teacher.id);
        const subjectsText = teacherSubjects.length > 0 ? 
          teacherSubjects.map(s => `${s.name} (${s.code})`).join('<br>') : 
          '<span style="color: #888;">Î”ÎµÎ½ Î´Î¹Î´Î¬ÏƒÎºÎµÎ¹ ÎºÎ¬Ï€Î¿Î¹Î¿ Ï„Î¼Î®Î¼Î±</span>';
        
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${teacher.id}</td>
          <td>${teacher.name}</td>
          <td>${teacher.subject}</td>
          <td>${teacher.phone || '-'}</td>
          <td>${teacher.email || '-'}</td>
          <td>${subjectsText}</td>
          <td>
            <div class="action-buttons">
              <button class="btn btn-primary btn-small" onclick="editTeacher(${teacher.id})">Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±</button>
              <button class="btn btn-danger btn-small" onclick="deleteTeacher(${teacher.id})">Î”Î¹Î±Î³ÏÎ±Ï†Î®</button>
              <button class="btn btn-info btn-small" onclick="viewTeacherDetails(${teacher.id})">Î›ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚</button>
            </div>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    // Initialize teachers display when data is loaded
    function initializeTeachersDisplay() {
      filteredTeachers = [...teachers];
      loadFilteredTeachers();
    }

    // Open add teacher modal
    function openAddTeacherModal() {
      document.getElementById('teacherModalTitle').textContent = 'Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎÎ­Î¿Ï… ÎšÎ±Î¸Î·Î³Î·Ï„Î®';
      document.getElementById('teacherForm').reset();
      document.getElementById('teacherId').value = '';
      document.getElementById('teacherModal').style.display = 'block';
    }

    // Edit teacher
    function editTeacher(teacherId) {
      const teacher = teachers.find(t => t.id === teacherId);
      if (!teacher) {
        console.error('Teacher not found:', teacherId);
        return;
      }
      
      document.getElementById('teacherModalTitle').textContent = 'Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± ÎšÎ±Î¸Î·Î³Î·Ï„Î®';
      document.getElementById('teacherId').value = teacher.id;
      document.getElementById('teacherName').value = teacher.name;
      document.getElementById('teacherSubject').value = teacher.subject;
      document.getElementById('teacherPhone').value = teacher.phone || '';
      document.getElementById('teacherEmail').value = teacher.email || '';
      
      document.getElementById('teacherModal').style.display = 'block';
    }

    // Close teacher modal
    function closeTeacherModal() {
      document.getElementById('teacherModal').style.display = 'none';
    }

    // Delete teacher
    async function deleteTeacher(teacherId) {
      const teacher = teachers.find(t => t.id === teacherId);
      if (!teacher) return;

      // Check if teacher has assigned subjects
      const assignedSubjects = subjects.filter(s => s.teacherId === teacherId);
      if (assignedSubjects.length > 0) {
        alert(`Î”ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ Ï„Î¿Î½ ÎºÎ±Î¸Î·Î³Î·Ï„Î® "${teacher.name}" Î³Î¹Î±Ï„Î¯ Î´Î¹Î´Î¬ÏƒÎºÎµÎ¹ ${assignedSubjects.length} Ï„Î¼Î®Î¼Î±Ï„Î±.\n\nÎ ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î±Î½Ï„Î±Î¸Î­ÏƒÎµÏ„Îµ Î±Ï…Ï„Î¬ Ï„Î± Ï„Î¼Î®Î¼Î±Ï„Î± ÏƒÎµ Î¬Î»Î»Î¿Ï…Ï‚ ÎºÎ±Î¸Î·Î³Î·Ï„Î­Ï‚.`);
        return;
      }

      if (confirm(`Î•Î¯ÏƒÏ„Îµ Î²Î­Î²Î±Î¹Î¿Î¹ ÏŒÏ„Î¹ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ Ï„Î¿Î½ ÎºÎ±Î¸Î·Î³Î·Ï„Î® "${teacher.name}";`)) {
        try {
          const response = await fetch(`/api/teachers/${teacherId}`, {
            method: 'DELETE'
          });

          if (response.ok) {
            // Remove from local arrays
            teachers = teachers.filter(t => t.id !== teacherId);
            filteredTeachers = filteredTeachers.filter(t => t.id !== teacherId);
            
            // Refresh displays
            loadFilteredTeachers();
            loadTeachersDropdown(); // Refresh teacher dropdowns
            loadSubjectTeachersDropdown(); // Refresh subject teacher dropdown
            loadEditSubjectTeachersDropdown(); // Refresh edit subject teacher dropdown
            
            showAlert('ÎŸ ÎºÎ±Î¸Î·Î³Î·Ï„Î®Ï‚ Î´Î¹Î±Î³ÏÎ¬Ï†Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!', 'success');
          } else {
            const error = await response.json();
            throw new Error(error.error || 'Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î· Î´Î¹Î±Î³ÏÎ±Ï†Î®');
          }
        } catch (error) {
          console.error('Error deleting teacher:', error);
          showAlert('Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î· Î´Î¹Î±Î³ÏÎ±Ï†Î®: ' + error.message, 'error');
        }
      }
    }

    // View teacher details
    function viewTeacherDetails(teacherId) {
      const teacher = teachers.find(t => t.id === teacherId);
      if (!teacher) return;

      const teacherSubjects = subjects.filter(s => s.teacherId === teacherId);
      let subjectsList = '';
      
      if (teacherSubjects.length > 0) {
        teacherSubjects.forEach(subject => {
          const enrolledCount = enrollments.filter(e => e.class_id === subject.id).length;
          subjectsList += `<li>${subject.name} (${subject.code}) - ${subject.class} - ${enrolledCount} Î¼Î±Î¸Î·Ï„Î­Ï‚</li>`;
        });
      } else {
        subjectsList = '<li>Î”ÎµÎ½ Î´Î¹Î´Î¬ÏƒÎºÎµÎ¹ ÎºÎ¬Ï€Î¿Î¹Î¿ Ï„Î¼Î®Î¼Î±</li>';
      }

      const detailsHtml = `
        <h3>Î›ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚ ÎšÎ±Î¸Î·Î³Î·Ï„Î®</h3>
        <p><strong>ÎŒÎ½Î¿Î¼Î±:</strong> ${teacher.name}</p>
        <p><strong>Î•Î¹Î´Î¹ÎºÏŒÏ„Î·Ï„Î±:</strong> ${teacher.subject}</p>
        <p><strong>Î¤Î·Î»Î­Ï†Ï‰Î½Î¿:</strong> ${teacher.phone || 'Î”ÎµÎ½ Î­Ï‡ÎµÎ¹ ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ·Î¸ÎµÎ¯'}</p>
        <p><strong>Email:</strong> ${teacher.email || 'Î”ÎµÎ½ Î­Ï‡ÎµÎ¹ ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ·Î¸ÎµÎ¯'}</p>
        <p><strong>Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ Î¤Î¼Î·Î¼Î¬Ï„Ï‰Î½:</strong> ${teacherSubjects.length}</p>
        <h4>Î¤Î¼Î®Î¼Î±Ï„Î± Ï€Î¿Ï… Î´Î¹Î´Î¬ÏƒÎºÎµÎ¹:</h4>
        <ul>${subjectsList}</ul>
      `;

      // Show in a simple alert for now - could be enhanced with a proper modal
      alert(detailsHtml.replace(/<[^>]*>/g, '\n').replace(/\n+/g, '\n'));
    }

    // Add event listeners for teachers search
    document.addEventListener('DOMContentLoaded', function() {
      // ...existing code...
      
      // Teachers search functionality
      document.getElementById('teacherSearchInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          searchTeachers();
        }
      });

      document.getElementById('teacherSearchInput').addEventListener('input', searchTeachers);
      document.getElementById('teacherSubjectFilter').addEventListener('change', searchTeachers);
      
      // Teacher form submission
      document.getElementById('teacherForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const teacherId = document.getElementById('teacherId').value;
        const teacherData = {
          name: document.getElementById('teacherName').value,
          subject: document.getElementById('teacherSubject').value,
          phone: document.getElementById('teacherPhone').value || null,
          email: document.getElementById('teacherEmail').value || null
        };

        try {
          let response;
          if (teacherId) {
            // Update existing teacher
            response = await fetch(`/api/teachers/${teacherId}`, {
              method: 'PUT',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(teacherData)
            });
          } else {
            // Create new teacher
            response = await fetch('/api/teachers', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(teacherData)
            });
          }

          if (response.ok) {
            const result = await response.json();
            
            if (teacherId) {
              // Update existing teacher in local array
              const teacherIndex = teachers.findIndex(t => t.id == teacherId);
              if (teacherIndex !== -1) {
                teachers[teacherIndex] = { ...teachers[teacherIndex], ...teacherData };
              }
            } else {
              // Add new teacher to local array
              const newTeacher = {
                id: result.id,
                ...teacherData
              };
              teachers.push(newTeacher);
            }
            
            // Refresh displays
            initializeTeachersDisplay();
            loadTeachersDropdown(); // Refresh teacher dropdowns
            loadSubjectTeachersDropdown(); // Refresh subject teacher dropdown
            loadEditSubjectTeachersDropdown(); // Refresh edit subject teacher dropdown
            
            closeTeacherModal();
            showAlert(teacherId ? 'ÎŸ ÎºÎ±Î¸Î·Î³Î·Ï„Î®Ï‚ ÎµÎ½Î·Î¼ÎµÏÏÎ¸Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!' : 'ÎŸ ÎºÎ±Î¸Î·Î³Î·Ï„Î®Ï‚ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!', 'success');
          } else {
            const error = await response.json();
            throw new Error(error.error || 'Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·');
          }
        } catch (error) {
          console.error('Error saving teacher:', error);
          showAlert('Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·: ' + error.message, 'error');
        }
      });
    });
  </script>
</body>
</html>
