<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Παλιά Θέματα - Μαθητικό Στέκι</title>
  <link rel="stylesheet" href="../style.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;400&display=swap" rel="stylesheet">
  <style>
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .filters-section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 30px;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      align-items: end;
    }
    
    .filter-group {
      display: flex;
      flex-direction: column;
      min-width: 150px;
    }
    
    .filter-group label {
      font-weight: bold;
      margin-bottom: 5px;
      color: #5b3c2a;
    }
    
    .filter-group select {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 14px;
    }
    
    .clear-btn {
      background: #6c757d;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
      height: fit-content;
    }
    
    .clear-btn:hover {
      background: #5a6268;
    }
    
    .pdf-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .pdf-item {
      background: white;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }
    
    .pdf-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }
    
    .pdf-header {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .pdf-icon {
      width: 40px;
      height: 40px;
      margin-right: 15px;
      color: #d32f2f;
    }
    
    .pdf-title {
      font-weight: bold;
      font-size: 16px;
      color: #5b3c2a;
      margin: 0;
    }
    
    .pdf-info {
      margin-bottom: 15px;
    }
    
    .pdf-meta {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      color: #666;
      margin-bottom: 5px;
    }
    
    .pdf-description {
      font-size: 14px;
      color: #666;
      line-height: 1.4;
    }
    
    .pdf-actions {
      display: flex;
      gap: 10px;
    }
    
    .btn-view {
      flex: 1;
      background: #28a745;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 5px;
      cursor: pointer;
      text-decoration: none;
      text-align: center;
      font-size: 14px;
    }
    
    .btn-view:hover {
      background: #218838;
    }
    
    .btn-download {
      flex: 1;
      background: #007bff;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 5px;
      cursor: pointer;
      text-decoration: none;
      text-align: center;
      font-size: 14px;
    }
    
    .btn-download:hover {
      background: #0056b3;
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
      font-size: 18px;
    }
    
    .no-files {
      text-align: center;
      padding: 40px;
      color: #666;
    }
    
    .no-files h3 {
      margin-bottom: 10px;
    }
    
    .pdf-badge {
      display: inline-block;
      background: #5b3c2a;
      color: white;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      margin-left: 10px;
    }
    
    .admin-notice {
      background: #fff3cd;
      border: 1px solid #ffeeba;
      color: #856404;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
    }
    
    .admin-notice a {
      color: #5b3c2a;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <div class="logo"><img src="logo.png" alt="logo"></div>
      <nav>
        <a href="#">Αρχική Σελίδα</a>
        <a href="#">Προγράμματα</a>
        <a href="#">Πανελλαδικές Εξετάσεις</a>
        <a href="#">Φωτογραφίες</a>
        <a href="#">Σχετικά με εμάς</a>
      </nav>
      <div class="icons">
        <a href="#"><img src="\elements\Group 17.svg" alt="fb" class="facebook-icon"></a>
        <a href="#"><img src="\elements\mdi_instagram.svg" alt="insta" class="instagram-icon"></a>
        <a href="#"><img src="\elements\phone.svg" alt="phone"></a>
        <a href="#"><img src="\elements\mail.svg" alt="mail"></a>
      </div>
      <a href="../index2.html" class="login-btn" style="text-decoration: none;">Είσοδος</a>
    </div>
  </header>
  
  <main>
    <div class="container">
      <h1>Παλιά Θέματα Πανελλαδικών</h1>
      
      <!-- Φίλτρα -->
      <div class="filters-section">
        <div class="filter-group">
          <label for="lykeio-filter">Τύπος Λυκείου:</label>
          <select id="lykeio-filter">
            <option value="">Όλα τα Λύκεια</option>
            <option value="ΓΕΛ">ΓΕΛ (Γενικό Λύκειο)</option>
            <option value="ΕΠΑΛ">ΕΠΑΛ (Επαγγελματικό Λύκειο)</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label for="year-filter">Έτος:</label>
          <select id="year-filter">
            <option value="">Όλα τα έτη</option>
            <option value="2024">2024</option>
            <option value="2023">2023</option>
            <option value="2022">2022</option>
            <option value="2021">2021</option>
            <option value="2020">2020</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label for="subject-filter">Μάθημα:</label>
          <select id="subject-filter">
            <option value="">Όλα τα μαθήματα</option>
            <!-- Τα μαθήματα θα ενημερώνονται δυναμικά -->
          </select>
        </div>
        
        <button id="clear-filters" class="clear-btn">Καθαρισμός Φίλτρων</button>
      </div>

      <!-- Πληροφορίες αρχείων -->
      <div id="files-info" class="admin-notice" style="display: none;">
        <strong> Πληροφορίες:</strong> 
        <span id="files-count-text"></span>
      </div>

      <!-- Περιοχή PDF αρχείων -->
      <div id="pdf-container" class="pdf-grid">
        <!-- Τα PDF θα φορτωθούν δυναμικά από JavaScript -->
        <div class="loading">Φόρτωση παλιών θεμάτων...</div>
      </div>

      <!-- Μήνυμα όταν δεν υπάρχουν αρχεία -->
      <div id="no-files-message" class="no-files" style="display: none;">
        <h3>Δεν υπάρχουν διαθέσιμα αρχεία</h3>
        <p>Δεν βρέθηκαν παλιά θέματα που να ταιριάζουν με τα κριτήρια αναζήτησης.</p>
      </div>
    </div>
  <footer>
    <div class="footer-content">
      <div class="footer-logo">Μαθητικό Στέκι</div>
      <div class="footer-links"  data-id="footer-links">
        <span>Καθηγητές:</span>
        <span>...</span>
      </div>
      <div class="footer-map" >
        <img src="map.png" alt="Χάρτης">
      </div>
    </div>
    <div class="footer-bottom">
      &copy; 2025 Μαθητικό Στέκι
    </div>
  </footer>
  <script src="../main.js"></script>
  <script src="../client-text.js"></script>
  <script>
    // Δυναμική φόρτωση PDF αρχείων
    let allPDFs = [];
    
    // Μαθήματα ανά τύπο λυκείου
    const subjectsByLykeio = {
      'ΓΕΛ': [
        'Μαθηματικά',
        'Φυσική', 
        'Χημεία',
        'Βιολογία',
        'Νεοελληνική Γλώσσα',
        'Αρχαία Ελληνικά',
        'Ιστορία',
        'Λατινικά',
        'Αγγλικά',
        'Γαλλικά',
        'Γερμανικά'
      ],
      'ΕΠΑΛ': [
        'Μαθηματικά',
        'Φυσική',
        'Νεοελληνική Γλώσσα',
        'Αγγλικά',
        'Ιστορία',
        'Οικονομικά',
        'Πληροφορική',
        'Τεχνολογία',
        'Τουρισμός'
      ]
    };
    
    // Φόρτωση PDF αρχείων από το API
    async function loadPDFs() {
      try {
        const response = await fetch('/api/pallia-themata');
        if (response.ok) {
          allPDFs = await response.json();
        } else {
          console.warn('Σφάλμα φόρτωσης από API, χρήση δείγματος');
          allPDFs = getSamplePDFs();
        }
        displayPDFs(allPDFs);
      } catch (error) {
        console.error('Σφάλμα φόρτωσης PDFs:', error);
        allPDFs = getSamplePDFs();
        displayPDFs(allPDFs);
      }
    }
    
    // Δείγμα δεδομένων (μόνο θέματα)
    function getSamplePDFs() {
      return [
        {
          id: 1,
          title: "Μαθηματικά Προσανατολισμού 2024",
          subject: "Μαθηματικά",
          year: "2024",
          type: "Θέματα",
          lykeio: "ΓΕΛ",
          filename: "mathimatika_2024_themata.pdf",
          description: "Θέματα Μαθηματικών Προσανατολισμού Πανελλαδικών Εξετάσεων 2024",
          uploadDate: "2024-07-15",
          fileSize: "2.3 MB"
        },
        {
          id: 2,
          title: "Φυσική Προσανατολισμού 2024",
          subject: "Φυσική",
          year: "2024",
          type: "Θέματα",
          lykeio: "ΓΕΛ",
          filename: "fysiki_2024_themata.pdf",
          description: "Θέματα Φυσικής Προσανατολισμού Πανελλαδικών Εξετάσεων 2024",
          uploadDate: "2024-07-15",
          fileSize: "1.8 MB"
        },
        {
          id: 3,
          title: "Νεοελληνική Γλώσσα 2024",
          subject: "Νεοελληνική Γλώσσα",
          year: "2024",
          type: "Θέματα",
          lykeio: "ΓΕΛ",
          filename: "neoeliniki_2024_themata.pdf",
          description: "Θέματα Νεοελληνικής Γλώσσας Πανελλαδικών Εξετάσεων 2024",
          uploadDate: "2024-07-15",
          fileSize: "1.5 MB"
        },
        {
          id: 4,
          title: "Μαθηματικά ΕΠΑΛ 2024",
          subject: "Μαθηματικά",
          year: "2024",
          type: "Θέματα",
          lykeio: "ΕΠΑΛ",
          filename: "mathimatika_epal_2024_themata.pdf",
          description: "Θέματα Μαθηματικών ΕΠΑΛ Πανελλαδικών Εξετάσεων 2024",
          uploadDate: "2024-07-15",
          fileSize: "2.0 MB"
        },
        {
          id: 5,
          title: "Οικονομικά ΕΠΑΛ 2024",
          subject: "Οικονομικά",
          year: "2024",
          type: "Θέματα",
          lykeio: "ΕΠΑΛ",
          filename: "oikonomika_epal_2024_themata.pdf",
          description: "Θέματα Οικονομικών ΕΠΑΛ Πανελλαδικών Εξετάσεων 2024",
          uploadDate: "2024-07-15",
          fileSize: "1.7 MB"
        },
        {
          id: 6,
          title: "Μαθηματικά Προσανατολισμού 2023",
          subject: "Μαθηματικά",
          year: "2023",
          type: "Θέματα",
          lykeio: "ΓΕΛ",
          filename: "mathimatika_2023_themata.pdf",
          description: "Θέματα Μαθηματικών Προσανατολισμού Πανελλαδικών Εξετάσεων 2023",
          uploadDate: "2023-07-15",
          fileSize: "2.1 MB"
        }
      ];
    }
    
    // Ενημέρωση μαθημάτων βάσει τύπου λυκείου
    function updateSubjects() {
      const lykeioFilter = document.getElementById('lykeio-filter').value;
      const subjectFilter = document.getElementById('subject-filter');
      
      // Καθαρισμός υπαρχουσών επιλογών
      subjectFilter.innerHTML = '<option value="">Όλα τα μαθήματα</option>';
      
      let subjects = [];
      if (lykeioFilter) {
        subjects = subjectsByLykeio[lykeioFilter] || [];
      } else {
        // Αν δεν έχει επιλεγεί λύκειο, εμφάνισε όλα τα μαθήματα
        subjects = [...new Set([...subjectsByLykeio['ΓΕΛ'], ...subjectsByLykeio['ΕΠΑΛ']])].sort();
      }
      
      subjects.forEach(subject => {
        const option = document.createElement('option');
        option.value = subject;
        option.textContent = subject;
        subjectFilter.appendChild(option);
      });
    }
    
    // Εμφάνιση PDF αρχείων
    function displayPDFs(pdfs) {
      const container = document.getElementById('pdf-container');
      const noFilesMessage = document.getElementById('no-files-message');
      const filesInfo = document.getElementById('files-info');
      const filesCountText = document.getElementById('files-count-text');
      
      // Ενημέρωση πληροφοριών αρχείων
      if (pdfs.length > 0) {
        let infoText = `Συνολικά ${pdfs.length} αρχείο/α διαθέσιμο/α από τη βάση δεδομένων`;
        filesCountText.textContent = infoText;
        filesInfo.style.display = 'block';
      } else {
        filesInfo.style.display = 'none';
      }
      
      if (pdfs.length === 0) {
        container.innerHTML = '';
        noFilesMessage.style.display = 'block';
        return;
      }
      
      noFilesMessage.style.display = 'none';
      
      container.innerHTML = pdfs.map(pdf => `
        <div class="pdf-item" data-year="${pdf.year}" data-subject="${pdf.subject}" data-lykeio="${pdf.lykeio || 'ΓΕΛ'}">
          <div class="pdf-header">
            <svg class="pdf-icon" viewBox="0 0 24 24" fill="currentColor">
              <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
            </svg>
            <div>
              <h3 class="pdf-title">${pdf.title}</h3>
              <span class="pdf-badge">${pdf.lykeio || 'ΓΕΛ'}</span>
            </div>
          </div>
          
          <div class="pdf-info">
            <div class="pdf-meta">
              <span><strong>Μάθημα:</strong> ${pdf.subject}</span>
              <span><strong>Έτος:</strong> ${pdf.year}</span>
            </div>
            <div class="pdf-meta">
              <span><strong>Λύκειο:</strong> ${pdf.lykeio || 'ΓΕΛ'}</span>
              <span><strong>Μέγεθος:</strong> ${pdf.file_size || pdf.fileSize}</span>
            </div>
            <div class="pdf-meta">
              <span><strong>Ημερομηνία:</strong> ${formatDate(pdf.upload_date || pdf.uploadDate)}</span>
            </div>
            <p class="pdf-description">${pdf.description}</p>
          </div>
          
          <div class="pdf-actions">
            <a href="javascript:void(0)" onclick="viewPDF('${pdf.filename}')" class="btn-view">
              👁️ Προβολή
            </a>
            <a href="javascript:void(0)" onclick="downloadPDF('${pdf.filename}', '${pdf.title}')" class="btn-download">
              📥 Λήψη
            </a>
          </div>
        </div>
      `).join('');
    }
    
    // Μορφοποίηση ημερομηνίας
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('el-GR');
    }
    
    // Προβολή PDF
    function viewPDF(filename) {
      // Αναζήτηση του PDF στη λίστα για να πάρουμε το ID
      const pdf = allPDFs.find(p => p.filename === filename);
      
      if (pdf) {
        // Άνοιγμα του PDF μέσω API για προβολή
        const pdfUrl = `/api/pallia-themata/${pdf.id}/view`;
        window.open(pdfUrl, '_blank');
      } else {
        alert('Το αρχείο δεν βρέθηκε');
      }
    }
    
    // Λήψη PDF
    function downloadPDF(filename, title) {
      // Αναζήτηση του PDF στη λίστα για να πάρουμε το ID
      const pdf = allPDFs.find(p => p.filename === filename);
      
      if (pdf) {
        // Λήψη του PDF μέσω API για download
        const pdfUrl = `/api/pallia-themata/${pdf.id}/download`;
        const link = document.createElement('a');
        link.href = pdfUrl;
        link.download = filename;
        link.style.display = 'none';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      } else {
        alert('Το αρχείο δεν βρέθηκε');
      }
    }
    
    // Φιλτράρισμα αρχείων
    function filterPDFs() {
      const lykeioFilter = document.getElementById('lykeio-filter').value;
      const yearFilter = document.getElementById('year-filter').value;
      const subjectFilter = document.getElementById('subject-filter').value;
      
      const filteredPDFs = allPDFs.filter(pdf => {
        const lykeioMatch = !lykeioFilter || (pdf.lykeio || 'ΓΕΛ') === lykeioFilter;
        const yearMatch = !yearFilter || pdf.year === yearFilter;
        const subjectMatch = !subjectFilter || pdf.subject === subjectFilter;
        
        return lykeioMatch && yearMatch && subjectMatch;
      });
      
      displayPDFs(filteredPDFs);
    }
    
    // Καθαρισμός φίλτρων
    function clearFilters() {
      document.getElementById('lykeio-filter').value = '';
      document.getElementById('year-filter').value = '';
      document.getElementById('subject-filter').value = '';
      updateSubjects(); // Επαναφορά όλων των μαθημάτων
      displayPDFs(allPDFs);
    }
    
    // Event listeners
    document.addEventListener('DOMContentLoaded', function() {
      loadPDFs();
      updateSubjects(); // Αρχική φόρτωση μαθημάτων
      
      document.getElementById('lykeio-filter').addEventListener('change', function() {
        updateSubjects();
        filterPDFs();
      });
      document.getElementById('year-filter').addEventListener('change', filterPDFs);
      document.getElementById('subject-filter').addEventListener('change', filterPDFs);
      document.getElementById('clear-filters').addEventListener('click', clearFilters);
    });
  </script>


</body>
</html>
